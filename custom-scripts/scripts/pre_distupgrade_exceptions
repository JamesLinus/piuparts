#!/bin/sh
set -e

log_debug() {
	echo "Debug: piuparts exception for package $PIUPARTS_OBJECTS"
}

if [ "$PIUPARTS_DISTRIBUTION_NEXT" = "squeeze" ]; then

	case ${PIUPARTS_OBJECTS%%=*} in
		crm114)
				#562946
				log_debug
				echo "crm114 crm114/forceupgrade boolean true" | debconf-set-selections
				;;
	esac

fi

if [ "$PIUPARTS_DISTRIBUTION_NEXT" = "wheezy" ]; then

	# dpkg 1.16 does not like the bad cnews version number cr.g7-40.4
	# cnews was removed after lenny
	case ${PIUPARTS_OBJECTS%%=*} in
		cnews)
				log_debug
				dpkg --purge cnews
				;;
	esac

	# WORKSAROUND #655969: lirc: prompting due to modified conffiles which where not modified by the user: /etc/lirc/hardware.conf
	if [ -f /etc/lirc/hardware.conf ]; then
		log_debug
		sed -i '/^DRIVER=/s/.*/DRIVER="UNCONFIGURED"/' /etc/lirc/hardware.conf
	fi

fi

if [ "$PIUPARTS_DISTRIBUTION_NEXT" = "jessie" ]; then

	# dpkg/jessie no longer ships install-info
	# which causes problems while removing packages from squeeze
	# or earlier that no longer exist in wheezy or jessie
	# (using the install-info package from jessie is not possible
	# due to interface incompatibilities)

	case ${PIUPARTS_OBJECTS%%=*} in
		octave3.2-info)
			# octave3.2-info was removed after squeeze
			log_debug
			dpkg --remove octave3.2-info
			;;
		polgen-doc)
			# polgen-doc was removed after lenny
			log_debug
			dpkg --remove polgen-doc
			;;
	esac

fi
