#!/bin/sh

MASTER=/org/piuparts.debian.org/master
DISTROS="sid squeeze"

FILE=`mktemp`

for distro in $DISTROS ; do 
	rgrep -l "Cannot initiate the connection to ftp.fi.debian.org" $MASTER/$distro/fail > $FILE
done


if [ -s $FILE ] ; then 
	echo "Network problems on piatti.debian.org detected!"
	echo 
	echo "Please review the following logfiles and most likely remove them." 
	echo "If it's always the same package failing, it's likely to be an issue in the"
	echo "package."
	echo
	cat $FILE | sed -e "s#/org/piuparts.debian.org/master/#http://piuparts.debian.org/#g"
	echo
	cat $FILE | sed -e "s#/org/piuparts.debian.org/master/#less /org/piuparts.debian.org/master/#"
	echo
	echo "----------------------------------------------------------------------"
	echo
	cat $FILE | sed -e "s#/org/piuparts.debian.org/master/#rm /org/piuparts.debian.org/master/#"
	echo
fi
rm $FILE
